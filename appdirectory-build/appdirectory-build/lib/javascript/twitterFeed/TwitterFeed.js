define(["jquery"],function(a){return function b(){var b=this;b.streamUpdateInterval=8e3,b.requestsPrSearch=10,b.statusQue=[],b.streamer,b.query,b.sinceId,b.runStreamer=function(){b.streamer=setInterval(function(){b.statusQue.length>0?b.renderStatus(b.statusQue.pop()):b.query&&b.twitterSearch()},b.streamUpdateInterval)},b.renderStatus=function(c){var d;c.text=unescape(encodeURIComponent(c.text)).toLowerCase();var e=b.query.replace(","," ").split(" "),f;for(f=0;f<e.length;f++)c.text=c.text.replace(e[f],"<span class='queryHighlight'>"+e[f]+"</span>");d="<p class='activeStatus' id='"+c.id+"'>"+c.text+"</p>",a("aside #status_stream").prepend(d),a("aside #status_stream p:hidden").fadeIn(3e3)},b.twitterSearch=function(c){c&&(b.query=c),b.statusQue=[],a("aside #status_stream p:hidden").remove(),b.streamer&&clearInterval(b.streamer),b.sinceId=undefined;var d=b.generateUrl(b.query);b.apiCall(d),b.runStreamer()},b.generateUrl=function(c){var d="http://search.twitter.com/search.json?&rpp=10&result_type=recent";c=c.toLowerCase().replace("#","%23");var e=c.split(","),f;d+="&q=";for(f=0;f<e.length;f++)d+=e[f],f<e.length-1&&(d+="+");b.sinceId&&(d+="&since_id="+a("aside #status_stream p:first-child").atr("id"));return d},b.apiCall=function(c){a.ajax({url:c,crossDomain:!0,dataType:"jsonp",success:function(a){var c=a.results;if(c){c=b.filterRetweets(c);var d;for(d=0;d<c.length;d++)b.statusQue.push(c[d]),b.sinceId=c[d].id;b.renderStatus(b.statusQue.pop())}}})},b.filterRetweets=function(a){var b,c,d=[];for(b=0;b<a.length;b++)for(c=0;c<a.length;c++)a[b].text==a[c].text&&b!=c&&a.splice(b,1);return a}}})