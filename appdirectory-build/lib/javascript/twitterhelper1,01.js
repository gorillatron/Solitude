function TwitterHelper(a,b,c,d){this.mAccount=a,this.mPassword=b,this.mAuthorization=btoa(a+":"+b),this.mThrobber=c,this.mServiceName=d;switch(d){case"twitter":this.mBaseURL="http://twitter.com/";break;case"identi.ca":this.mBaseURL="http://identi.ca/api/";break;default:throw"TwitterHelper: bad service string"}this.statuses._self=this,this.users._self=this,this.direct_messages._self=this,this.friendships._self=this,this.friends._self=this,this.followers._self=this,this.account._self=this,this.favorites._self=this,this.notifications._self=this,this.blocks._self=this,this.help._self=this}var EXPORTED_SYMBOLS=["TwitterHelper"];typeof JSON=="undefined"&&Components.utils.import("resource://gre/modules/JSON.jsm"),TwitterHelper.prototype._localizedError=function(a,b){var c="";switch(b){case"resp304":c="Not Modified: there was no new data to return.";break;case"resp400":c="Bad Request: your request is invalid, did you exceed the rate limit?";break;case"resp401":c="Not Authorized: either you need to provide authentication credentials, or the credentials provided aren't valid.";break;case"resp403":c="Forbidden: access denied to requested data.";break;case"resp404":c="Not Found: either you're requesting an invalid URI or the resource in question doesn't exist (ex: no such user). ";break;case"resp500":c="Internal Server Error";break;case"resp502":c="Bad Gateway: returned if the service is down or being upgraded.";break;case"resp503":c="Service Unavailable: the servers are up, but are overloaded with requests.  Try again later.";break;case"MissingIdParameter":c="Missing id parameter";break;case"EmptyStatus":c="Cannot update with empty status";break;case"EmptyDMRecipient":c="Empty recipient for Direct Message";break;case"EmptyDMText":c="Empty text for Direct Message";break;case"MissingUserForFriendshipTest":c="Cannot test friendship because one user parameter is missing";break;case"WrongDevice":c="Trying to update unknown device";break;case"NothingToUpdateProfileColors":c="Nothing to update, all colors are empty";break;default:}Components.classes["@mozilla.org/embedcomp/prompt-service;1"].getService(Components.interfaces.nsIPromptService).alert(null,a,c)},TwitterHelper.prototype._onreadystatechangeTwitter=function(a,b,c,d,e){if(a.readyState=="4"){this.mThrobber&&this.mThrobber.setAttribute("hidden","true");switch(a.status){case 200:if(b)if(a.responseXML)b(e,a.responseXML,d);else{try{var f=JSON.parse?JSON.parse(a.responseText):JSON.fromString(a.responseText)}catch(g){Components.classes["@mozilla.org/embedcomp/prompt-service;1"].getService(Components.interfaces.nsIPromptService).alert(null,e.mServiceName,"Cannot parse JSON answer");return}b(e,f,d)}break;case 304:case 400:case 401:case 403:case 404:case 500:case 502:case 503:e._localizedError(e.mServiceName,"resp"+a.status),c&&c(e,aXMLRequest,d);break;default:}}},TwitterHelper.prototype._getXmlRequest=function(a,b,c,d){this.mThrobber&&this.mThrobber.removeAttribute("hidden");var e=Components.classes["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance(Components.interfaces.nsIXMLHttpRequest),f=this;e.onreadystatechange=function(){f._onreadystatechangeTwitter(e,b,c,d,f)},e.open("GET",a,!0),e.channel.loadFlags|=Components.interfaces.nsIRequest.LOAD_BYPASS_CACHE,e.channel instanceof Components.interfaces.nsISupportsPriority&&(e.channel.priority=Components.interfaces.nsISupportsPriority.PRIORITY_LOWEST);return e},TwitterHelper.prototype._postXmlRequest=function(a,b,c,d){this.mThrobber&&this.mThrobber.removeAttribute("hidden");var e=Components.classes["@mozilla.org/xmlextras/xmlhttprequest;1"].createInstance(Components.interfaces.nsIXMLHttpRequest),f=this;e.onreadystatechange=function(){f._onreadystatechangeTwitter(e,b,c,d,f)},e.open("POST",a,!0),e.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2005 00:00:00 GMT");return e},TwitterHelper.prototype._sendRequest=function(a,b,c,d,e){var f=this._getXmlRequest(a,b,c,e);d&&f.setRequestHeader("Authorization","Basic "+this.mAuthorization),f.send(null)},TwitterHelper.prototype._sendPostRequest=function(a,b,c,d,e){var f=this._postXmlRequest(a,b,c,e);d&&f.setRequestHeader("Authorization","Basic "+this.mAuthorization),f.setRequestHeader("Content-length",0),f.send(null)},TwitterHelper.prototype._addParamToQueryURL=function(a,b,c,d){var e=a;c&&(b?e+="&":e+="?",e+=d+"="+escape(c.toString().replace(/ /g,"+")));return e},TwitterHelper.prototype.statuses={},TwitterHelper.prototype.users={},TwitterHelper.prototype.direct_messages={},TwitterHelper.prototype.friendships={},TwitterHelper.prototype.friends={},TwitterHelper.prototype.followers={},TwitterHelper.prototype.account={},TwitterHelper.prototype.favorites={},TwitterHelper.prototype.notifications={},TwitterHelper.prototype.blocks={},TwitterHelper.prototype.help={},TwitterHelper.prototype.statuses.friends_timeline=function(a,b,c,d,e,f,g,h){var i=this._self.mBaseURL+"statuses/friends_timeline."+d;i=this._self._addParamToQueryURL(i,!1,e,"since"),i=this._self._addParamToQueryURL(i,e,f,"since_id"),i=this._self._addParamToQueryURL(i,e||f,g,"count"),i=this._self._addParamToQueryURL(i,e||f||g,h,"page"),this._self._sendRequest(i,a,b,!0,c)},TwitterHelper.prototype.statuses.user_timeline=function(a,b,c,d,e,f,g,h,i){var j;e?j=this._self.mBaseURL+"statuses/user_timeline/"+e+"."+d:j=this._self.mBaseURL+"statuses/user_timeline."+d,j=this._self._addParamToQueryURL(j,!1,f,"since"),j=this._self._addParamToQueryURL(j,f,g,"since_id"),j=this._self._addParamToQueryURL(j,f||g,h,"count"),j=this._self._addParamToQueryURL(j,f||g||h,i,"page"),this._self._sendRequest(j,a,b,!0,c)},TwitterHelper.prototype.statuses.friends=function(a,b,c,d,e,f){var g;e?g=this._self.mBaseURL+"statuses/friends/"+e+"."+d:g=this._self.mBaseURL+"statuses/friends."+d,g=this._self._addParamToQueryURL(g,!1,f,"page"),this._self._sendRequest(g,a,b,!0,c)},TwitterHelper.prototype.statuses.followers=function(a,b,c,d,e,f){var g;e?g=this._self.mBaseURL+"statuses/followers/"+e+"."+d:g=this._self.mBaseURL+"statuses/followers."+d,g=this._self._addParamToQueryURL(g,!1,f,"page"),this._self._sendRequest(g,a,b,!0,c)},TwitterHelper.prototype.statuses.show=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"statuses/show."+d;f+="?id="+e,this._self._sendRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.statuses.replies=function(a,b,c,d,e,f,g){var h=this._self.mBaseURL+"statuses/replies."+d;h=this._self._addParamToQueryURL(h,!1,e,"since"),h=this._self._addParamToQueryURL(h,e,f,"since_id"),h=this._self._addParamToQueryURL(h,e||f,g,"page"),this._self._sendRequest(h,a,b,!0,c)},TwitterHelper.prototype.statuses.destroy=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"statuses/destroy/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.statuses.public_timeline=function(a,b,c,d){var e=this._self.mBaseURL+"statuses/public_timeline."+d;this._self._sendRequest(e,a,b,!1,c)},TwitterHelper.prototype.statuses.update=function(a,b,c,d,e,f,g){if(e){var h=this._self.mBaseURL+"statuses/update."+d;h+="?status="+escape(e),h=this._self._addParamToQueryURL(h,!0,f,"in_reply_to_status_id"),h=this._self._addParamToQueryURL(h,!0,g,"source"),this._self._sendPostRequest(h,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"EmptyStatus")},TwitterHelper.prototype.users.show=function(a,b,c,d,e,f){if(e||f){var g;f?(g=this._self.mBaseURL+"users/show."+d,g=this._self._addParamToQueryURL(g,!1,f,"email")):g=this._self.mBaseURL+"users/show/"+e+"."+d,this._self._sendRequest(g,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.direct_messages.inbox=function(a,b,c,d,e,f,g){var h=this._self.mBaseURL+"direct_messages."+d;h=this._self._addParamToQueryURL(h,!1,e,"since"),h=this._self._addParamToQueryURL(h,e,f,"since_id"),h=this._self._addParamToQueryURL(h,e||f,g,"page"),this._self._sendRequest(h,a,b,!0,c)},TwitterHelper.prototype.direct_messages.sent=function(a,b,c,d,e,f,g){var h=this._self.mBaseURL+"direct_messages/sent."+d;h=this._self._addParamToQueryURL(h,!1,e,"since"),h=this._self._addParamToQueryURL(h,e,f,"since_id"),h=this._self._addParamToQueryURL(h,e||f,g,"page"),this._self._sendRequest(h,a,b,!0,c)},TwitterHelper.prototype.direct_messages.new=function(a,b,c,d,e,f){if(e){if(!f){this._self._localizedError(this._self.mServiceName,"EmptyDMText");return}var g=this._self.mBaseURL+"direct_messages/new."+d;g=this._self._addParamToQueryURL(g,!1,e,"user"),g=this._self._addParamToQueryURL(g,!0,f,"text"),this._self._sendPostRequest(g,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"EmptyDMRecipient")},TwitterHelper.prototype.direct_messages.destroy=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"direct_messages/destroy/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.friendships.create=function(a,b,c,d,e,f){if(e){var g=this._self.mBaseURL+"friendships/create/"+e+"."+d;g=this._self._addParamToQueryURL(g,!1,f,"follow"),this._self._sendPostRequest(g,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.friendships.destroy=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"friendships/destroy/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.friendships.exists=function(a,b,c,d,e,f){if(e&&f){var g=this._self.mBaseURL+"friendships/exists."+d;g=this._self._addParamToQueryURL(g,!1,e,"user_a"),g=this._self._addParamToQueryURL(g,!0,f,"user_b"),this._self._sendRequest(g,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingUserForFriendshipTest")},TwitterHelper.prototype.friends.ids=function(a,b,c,d,e){var f;e?f=this._self.mBaseURL+"friends/ids/"+e+"."+d:f=this._self.mBaseURL+"friends/ids."+d,this._self._sendRequest(f,a,b,!0,c)},TwitterHelper.prototype.followers.ids=function(a,b,c,d,e){var f;e?f=this._self.mBaseURL+"followers/ids/"+e+"."+d:f=this._self.mBaseURL+"followers/ids."+d,this._self._sendRequest(f,a,b,!0,c)},TwitterHelper.prototype.account.verify_credentials=function(a,b,c,d){var e=this._self.mBaseURL+"account/verify_credentials."+d;this._self._sendRequest(e,a,b,!0,c)},TwitterHelper.prototype.account.end_session=function(a,b,c,d){var e=this._self.mBaseURL+"account/end_session."+d;this._self._sendPostRequest(e,a,b,!0,c)},TwitterHelper.prototype.account.update_delivery_device=function(a,b,c,d,e){if(e!="sms"&&e!="im"&&e!="none")this._self._localizedError(this._self.mServiceName,"WrongDevice");else{var f=this._self.mBaseURL+"account/update_delivery_device."+d;f=this._self._addParamToQueryURL(f,!1,e,"device"),this._self._sendPostRequest(f,a,b,!0,c)}},TwitterHelper.prototype.account.update_profile_colors=function(a,b,c,d,e,f,g,h,i){if(e||f||g||h||i){var j=this._self.mBaseURL+"account/update_profile_colors."+d;j=this._self._addParamToQueryURL(j,!1,e,"profile_background_color"),j=this._self._addParamToQueryURL(j,e,f,"profile_text_color"),j=this._self._addParamToQueryURL(j,e||f,g,"profile_link_color"),j=this._self._addParamToQueryURL(j,e||f||g,h,"profile_sidebar_fill_color"),j=this._self._addParamToQueryURL(j,e||f||g||h,i,"profile_sidebar_border_color"),this._self._sendPostRequest(j,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"NothingToUpdateProfileColors")},TwitterHelper.prototype.account.rate_limit_status=function(a,b,c,d){var e=this._self.mBaseURL+"account/rate_limit_status."+d;this._self._sendRequest(e,a,b,!0,c)},TwitterHelper.prototype.account.update_profile=function(a,b,c,d,e,f,g,h,i){var j=this._self.mBaseURL+"account/update_profile."+d;j=this._self._addParamToQueryURL(j,!1,e,"name"),j=this._self._addParamToQueryURL(j,e,f,"email"),j=this._self._addParamToQueryURL(j,e||f,g,"url"),j=this._self._addParamToQueryURL(j,e||f||g,h,"location"),j=this._self._addParamToQueryURL(j,e||f||g||h,i,"description"),this._self._sendPostRequest(j,a,b,!0,c)},TwitterHelper.prototype.favorites.favorites=function(a,b,c,d,e,f){var g;e?g=this._self.mBaseURL+"favorites/"+e+"."+d:g=this._self.mBaseURL+"favorites."+d,g=this._self._addParamToQueryURL(g,!1,f,"page"),this._self._sendRequest(g,a,b,!0,c)},TwitterHelper.prototype.favorites.create=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"favorites/create/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.favorites.destroy=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"favorites/destroy/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.notifications.follow=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"notifications/follow/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.notifications.leave=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"notifications/leave/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.blocks.create=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"blocks/create/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.blocks.destroy=function(a,b,c,d,e){if(e){var f=this._self.mBaseURL+"blocks/destroy/"+e+"."+d;this._self._sendPostRequest(f,a,b,!0,c)}else this._self._localizedError(this._self.mServiceName,"MissingIdParameter")},TwitterHelper.prototype.help.test=function(a,b,c,d){var e=this._self.mBaseURL+"help/test."+d;this._self._sendRequest(e,a,b,!0,c)},TwitterHelper.prototype.isMention=function(a){var b=a.match(/(@\w*)/g);for(var c=0;c<b.length;c++)if(b[c]=="@"+this.mAccount)return!0;return!1}