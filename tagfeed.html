<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
    <head> 
        <link rel="shortcut icon" href="static/grphx/icon.ico"/> 
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
        <title>Solitude</title>
        <link rel="stylesheet" type="text/css" href="style/css/yui_reset.css"/>
		    <link rel="stylesheet" type="text/css" href="style/css/solitude_main.css"/>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script> 
		    <script src="lib/javascript/jquery.ui.js"></script>
        <STYLE type="text/css">
          aside{
            position: relative;
            width: 23%;
            margin-left: 120px;
            margin-top: 2px;
            min-height: 700px;
            max-height: 700px;
            overflow: hidden;
          }
          aside p{
            position: relative;
            width: 95%;
            margin: 0px auto 5px auto;
            display: none;
            padding: 2%;
            font-size: 11px;
            line-height: 22px;
            background-color: rgba(148/199/182, 0.5);
            border: 2px solid rgba(148/199/182, 0.2);
            border-radius: 4px;
            -moz-border-radius: 4px;
            -webkit-border-radius: 4px;
            -o-border-radius: 4px;
            color: rgba(64/59/51, 1);
          }
          .hashtag{
            color: rgba(211/100/59, 1);
          }
          nav{
            position: relative;
            width: 23%;
            border: 1px solid gray;
            margin-left: 120px;
            margin-top: 70px;
            min-height: 50px;
          }
          nav table tr{
            width: 100%;
          }
          nav table td{
            text-align: center;
            line-height: 50ox;
            width: 130px;
            height: 50px;
          }
          nav table td:hover{
            background: gray;
          }
        </STYLE> 
        
        <script type="text/javascript" >
          $(document).ready(function(){ 
          
            
            function twitterTagFeed(){
              
              var self = this;
              
              this.apiCallInterval = 100000;
              this.query;
              this.sinceId;
              
              this.run = function(){
                var firstUrl = self.generateUrl(self.query);
                self.apiCall(firstUrl);
                setInterval(function(){
                  var url = self.generateUrl(self.query);
                  self.apiCall(url);
                }, this.apiCallInterval);
              };
              
              this.setState = function(state){
                this.state = this.states[state];
              };
              
              this.generateUrl = function(query){
                var url = "http://search.twitter.com/search.json?&rpp=10&result_type=recent";
                var query = query.split(' ').join('');
                query = query.toLowerCase();
                var queryParams = query.split(",");
                var qi;
                url += "&q=";
                for(qi = 0; qi < queryParams.length; qi++){
                  url += "%23"+queryParams[qi];
                  if(qi < queryParams.length -1){
                    url += "&";
                  }
                }
                if(this.sinceId){
                  url += "&since_id="+$('aside p:first-child').atr('id');
                }
                return url;
              };
              
              this.apiCall = function(url){
                $.ajax({
                  url: url,
                  crossDomain: true,
                  dataType: "jsonp",
                  success: function(response){
                    var feedData = response['results'];
                    if(feedData){
                      feedData = self.filterRetweets(feedData);
                      self.statusRenderer(feedData.reverse());
                    }
                  }
                });
              };
              
              this.filterRetweets = function(statuses){
                var si;
                var sii;
                var filteredStatuses = [];
                for(si = 0; si < statuses.length; si++){
                  for(sii = 0; sii < statuses.length; sii++){
                    if(statuses[si].text == statuses[sii].text && si != sii){
                      statuses.splice(si,1);
                    }
                  }
                }
                return statuses;
              };
              
              this.statusRenderer = function(feedData){
                var statIt;
                var interValSpeed = (this.apiCallInterval / feedData.length)-300;
                for(statIt = 0; statIt < feedData.length; statIt++){
                  var status = unescape(encodeURIComponent(feedData[statIt].text));
                  status = status.toLowerCase();
                  status = status.replace("#"+self.query, "<span class='hashtag'>#"+self.query+"</span>")
                  $('aside').prepend("<p id='"+feedData[statIt].id+"'>"+status+"</p>");
                  if((statIt+1) == feedData.length){
                  }
                }
                $($('aside p:hidden').get().reverse()).each(function(index, stat){
                    setTimeout(function(){
                      $(stat).fadeIn(3700);
                    }, interValSpeed * index);
                });
              }
              
            }
            
            var tf = new twitterTagFeed();
            tf.query = "mornings";
            tf.run();
            
            
          });
        </script> 
    
    </head> 

    <body>
    
    <nav>
      <table>
        <tr>
          <td id="run">run</td>
          <td id="pause">pause</td>
          <td id="stop">stop</td>
        </tr>
      </table>
    </nav>
    <aside>
    </aside>
    
    
    
    
    </body>

</html>