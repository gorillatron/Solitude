<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
    <head> 
        <link rel="shortcut icon" href="static/grphx/icon.ico"/> 
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
        <title>Solitude</title>
        <link rel="stylesheet" type="text/css" href="style/css/yui_reset.css"/>
		    <link rel="stylesheet" type="text/css" href="style/css/solitude_main.css"/>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script> 
		    <script src="lib/javascript/jquery.ui.js"></script>
        <STYLE type="text/css">
          aside{
            position: relative;
            width: 23%;
            border: 1px solid gray;
            margin-left: 630px;
            margin-top: 200px;
            min-height: 400px;
          }
        </STYLE> 
        
        <script type="text/javascript" >
          $(document).ready(function(){ 
          
            
            function twitterTagFeed(){
              
              var self = this;
              
              this.states = {1:'running', 2:'stopped', 3:'paused'};
              this.state = 2;
              this.apiCallInterval = 10000;
              this.query;
              this.sinceId;
              
              this.run = function(){
                setInterval(function(){
                  var url = self.generateUrl(self.query);
                  self.apiCall(url);
                }, this.apiCallInterval);
              };
              
              this.generateUrl = function(query){
                var url = "http://search.twitter.com/search.json?&rpp=5&result_type=recent";
                var query = query.split(' ').join('');
                var queryParams = query.split(",");
                var qi;
                url += "&q=";
                for(qi = 0; qi < queryParams.length; qi++){
                  url += "%23"+queryParams[qi];
                  if(qi < queryParams.length -1){
                    url += "&";
                  }
                }
                if(this.sinceId){
                  url += "&since_id="+$('aside p:first-child').atr('id');
                }
                return url;
              };
              
              this.apiCall = function(url){
                $.ajax({
                  url: url,
                  crossDomain: true,
                  dataType: "jsonp",
                  success: function(response){
                    var feedData = response['results'];
                    if(feedData){
                      self.statusRenderer(feedData.reverse());
                    }
                  }
                });
              };
              
              
              this.statusRenderer = function(feedData){
                var statIt;
                var interValSpeed = (this.apiCallInterval / feedData.length)-300;
                for(statIt = 0; statIt < feedData.length; statIt++){
                  var status = unescape(encodeURIComponent(feedData[statIt].text));
                  $('aside').prepend("<p id='"+feedData[statIt].id+"' style='border-bottom: 1px solid black; width: 100%; display: none; font-size: 10px;'>"+status+"</p>");
                  if((statIt+1) == feedData.length){
                  }
                }
                $($('aside p:hidden').get().reverse()).each(function(index, stat){
                    setTimeout(function(){
                      $(stat).fadeIn('slow');
                    }, interValSpeed * index);
                });
              }
              
            }
            
            var tf = new twitterTagFeed();
            tf.query = "somewherekokasi";
            //$('aside').append(tf.generateUrl("ruby"));
            tf.run();
            
          });
        </script> 
    
    </head> 

    <body>
    
    <aside>
    </aside>
    
    
    
    
    </body>

</html>